<!doctype html>
<html>
<head>
  <!-- ============================================== -->
  <!-- МЕТАДАННЫЕ -->
  <!-- ============================================== -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Союзмультфильм AR - Фото с персонажами</title>

  <!-- ============================================== -->
  <!-- СТИЛИ -->
  <!-- ============================================== -->
  <link rel="stylesheet" href="css/spinner.css">
  <link rel="stylesheet" href="css/scanning.css">
  <link rel="stylesheet" href="css/capture.css">

  <!-- ============================================== -->
  <!-- ВНЕШНИЕ БИБЛИОТЕКИ -->
  <!-- ============================================== -->
  
  <script src="js/aframe.min.js"></script>
  <script src="js/mindar-image-aframe.prod.js"></script>
  <script src="js/aframe-extras.min.js"></script>
  
  <!-- ============================================== -->
  <!-- НАШИ СКРИПТЫ -->
  <!-- ============================================== -->
  <script src="js/loading-timeout.js"></script>
  <script src="js/aframe-spritesheet-animation.js"></script>
  <script src="js/ar-animations.js"></script>

</head>

<body>
  <!-- ============================================== -->
  <!-- ОВЕРЛЕИ И ИНТЕРФЕЙС -->
  <!-- ============================================== -->
  
  <!-- Оверлей сканирования -->
  <div id="scanning-overlay" class="hidden">
    <div class="scanning-container">
      <img class="stairs-image" src="img/stairs.png" alt="Stairs">
      <div class="image-carousel">
        <img class="main-image active" src="img/gena_cheba_shapo.png" alt="Gena Cheba Shapo">
        <img class="main-image" src="img/volk.png" alt="Volk">
      </div>
      <img class="camera-icon" src="img/camera_icon.png" alt="Camera">
      <div class="scanning-text">Наведите камеру<br>на скульптуру</div>
    </div>
  </div>

  <!-- Access Popup - запрос разрешений -->
  <div class="access-popup">
    <img src="img/access_popup.png" alt="Access Permission">
  </div>

  <!-- Оверлей загрузки -->
  <div id="loading-overlay">
    <div class="loading-content">
      <div class="spinner"></div>
      <div class="loading-text">Загружаем ваше будущее «Вааау». Пожалуйста, подождите</div>
    </div>
  </div>

  <!-- Блок пульта с кнопкой фото -->
  <div id="pultContainer">
    <img src="img/Pult.gif" alt="Pult" id="pultImage">
    <button id="photoBtn" disabled></button>
  </div>

  <!-- Поп-ап превью фото -->
  <div id="previewOverlay" class="hidden">
    <div id="previewBox">
      <button id="closeBtn" class="close-button">
        <img src="img/close_button.png" alt="Close">
      </button>
      <div class="camera-illustration">
        <img src="img/camera_illustration.png" alt="Camera">
      </div>
      <img id="previewImg" alt="preview">
      <div class="save-text">Нажмите «Сохранить»<br>и подтвердите загрузку<br>вашей фотографии</div>
      <button id="downloadBtn" class="download-button">
        <img src="img/button_save.png" alt="Save">
      </button>
    </div>
  </div>

  <!-- Поп-ап после скачивания -->
  <div id="afterOverlay" class="hidden">
    <div id="afterBox">
      <button id="laterBtn" class="close-button">
        <img src="img/close_button.png" alt="Close">
      </button>
      <div class="vr-illustration">
        <img src="img/vr_illustration.png" alt="VR">
      </div>
      <div class="park-photo-container">
        <img id="afterImg" src="img/park_photo_01.png" alt="Park Photo">
        <div class="to-park-overlay">
          <img src="img/to_park.png" alt="To Park">
        </div>
      </div>
      <div class="park-welcome-text">Мы ждем вас<br> в парке!</div>
      <div class="save-text">Покажите фото на кассе парка и получитие скидку на посещение</div>
      <a href="https://souzmultpark.ru/" target="_blank">
        <button id="goParkBtn" class="download-button">
          <img src="img/buy_ticket.png" alt="Buy Ticket">
        </button>
      </a>
    </div>
  </div>

  <!-- ============================================== -->
  <!-- AR СЦЕНА -->
  <!-- ============================================== -->
  <a-scene
  mindar-image="
    imageTargetSrc: sculptures.mind;
    maxTrack: 1;
    uiLoading: #loading-overlay;
    uiScanning: #scanning-overlay;
    uiError: no;
    missTolerance: 10;          
    filterMinCF: 0.0001;       
    filterBeta: 0.0001;         
    warmupTolerance: 20
    deviceConstraints: {
      video: {
        facingMode: 'environment'
      }
    }"
  color-space="sRGB"
  renderer="colorManagement: true, physicallyCorrectLights"
  vr-mode-ui="enabled: false"
  device-orientation-permission-ui="enabled: false">

    <!-- 3D модели и текстуры -->
    <a-assets>
      <a-asset-item id="gena-cheba-shapo-model" src="models/gena-cheba-shapo-model-animated.glb"></a-asset-item>
      <a-asset-item id="volk-model" src="models/volk-model-animated.glb"></a-asset-item>
      <img id="sheet" src="img/sprite_sheet.jpg">
    </a-assets>

    <!-- Камера AR -->
    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

    <!-- Первый маркер - Гена Чебурашка Шапокляк -->
    <a-entity mindar-image-target="targetIndex: 0" play-on-visible>
      <a-entity
      id="animated-model"
      gltf-model="#gena-cheba-shapo-model"
      position="0 0 0"
      scale="0.5 0.5 0.5">
    </a-entity>
      <a-plane
      id="gif-element"
      geometry="primitive: plane; height:0.35; width:0.51"
      material="shader: flat; src: #sheet; transparent: false;"
      spritesheet-animation="rows: 16; columns: 11; frameDuration: 0.1; loop: true;"
      position="-0.03 0.85 0.15"
      visible="true"
      scale="0 0 0"></a-plane>
    </a-entity>

    <!-- Второй маркер - Волк -->
    <a-entity mindar-image-target="targetIndex: 1" play-on-visible>
      <a-entity
      id="animated-model"
      gltf-model="#volk-model"
      position="0 0 0"
      scale="0.5 0.5 0.5">
    </a-entity>
    <a-plane
    id="gif-element"
    geometry="primitive: plane; height:0.35; width:0.51"
    material="shader: flat; src: #sheet; transparent: false;"
    spritesheet-animation="rows: 16; columns: 11; frameDuration: 0.1; loop: true;"
    position="-0.03 0.73 0.15"
    visible="true"
    scale="0 0 0"></a-plane>
    </a-entity>

 

  <!-- ============================================== -->
  <!-- ОСНОВНЫЕ СКРИПТЫ ПРИЛОЖЕНИЯ -->
  <!-- ============================================== -->
  <script src="js/capture.js"></script>
  <script src="js/ui-controls.js"></script>
  
</body>
</html>
